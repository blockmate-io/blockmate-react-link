{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["const EVENT_MESSAGES = {\n  linkConnect: ``,\n  verifyPhone: `verify-phone`,\n  changePhone: `change-phone`,\n  enableTransfer: `enable-transfer`,\n  transferAssets: `transfer-assets`,\n  cryptoSavings: `crypto-savings`,\n  close: 'blockmate-iframe-close'\n}\n\nexport const handleOpen = (message = '', accountId) => {\n  if (!Object.keys(EVENT_MESSAGES).includes(message)) {\n    message = 'linkConnect'\n  }\n\n  window.parent.postMessage({ type: message, accountId }, '*')\n}\n\nexport const handleClose = (url) => {\n  window.parent.postMessage({ type: 'close', url }, '*')\n}\n\nexport const LinkModal = ({\n  jwt,\n  url = 'https://link.blockmate.io/',\n  cleanupActions = {}\n}) => {\n  if (!jwt) return null\n\n  const body = document.querySelector('body')\n  const iframeStyle =\n    'display:block; position:fixed; width:100%; height:100%; z-index:100; border:none; top:0; right:0'\n\n  const createIframe = (url, accountId) => {\n    const iframeId = 'link-iframe'\n    const existingIframe = document.getElementById(iframeId)\n    if (!existingIframe) {\n      const iframe = document.createElement('iframe')\n      iframe.setAttribute('src', `${url}?jwt=${jwt}&accountId=${accountId}`)\n      iframe.setAttribute('style', iframeStyle)\n      iframe.setAttribute('id', iframeId)\n      body.appendChild(iframe)\n    }\n  }\n\n  const removeIframe = (event) => {\n    const iframe = document.querySelector('#link-iframe')\n    body.removeChild(iframe)\n    if (event.data.url) {\n      window.location = event.data.url\n    }\n\n    const endResult = event?.data?.endResult\n    if (endResult && cleanupActions[endResult]) {\n      cleanupActions[endResult]()\n    }\n  }\n\n  window.onmessage = function (event) {\n    if (!Object.hasOwn(EVENT_MESSAGES, event.data.type)) {\n      return null\n    }\n\n    if (event?.data?.type === 'close') {\n      removeIframe(event)\n    } else {\n      createIframe(\n        new URL(url, EVENT_MESSAGES[event.data.type]).href,\n        event.data.accountId\n      )\n    }\n  }\n\n  return null\n}\n"],"names":["EVENT_MESSAGES","linkConnect","verifyPhone","changePhone","enableTransfer","transferAssets","cryptoSavings","close","handleOpen","message","accountId","Object","keys","includes","window","parent","postMessage","type","handleClose","url","LinkModal","jwt","cleanupActions","body","document","querySelector","iframeStyle","createIframe","iframeId","existingIframe","getElementById","iframe","createElement","setAttribute","appendChild","removeIframe","event","removeChild","data","location","endResult","onmessage","hasOwn","URL","href"],"mappings":"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"}