{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["const linkUrl = 'https://link-dev-ovh.blockmate.io/'\n\nexport const handleOpen = (message = '', accountId) => {\n  if (!Object.keys(EVENT_MESSAGES).includes(message)) {\n    message = 'linkConnect'\n  }\n  window.parent.postMessage({ type: EVENT_MESSAGES[message], accountId }, '*')\n}\n\nexport const handleClose = (url) => {\n  window.parent.postMessage({ type: EVENT_MESSAGES.close, url }, '*')\n}\n\nconst EVENT_MESSAGES = {\n  linkConnect: `${linkUrl}`,\n  close: 'blockmate-iframe-close',\n  verifyPhone: `${linkUrl}verify-phone`,\n  changePhone: `${linkUrl}change-phone`,\n  enableTransfer: `${linkUrl}enable-transfer`,\n  transferAssets: `${linkUrl}transfer-assets`,\n  cryptoSavings: `${linkUrl}crypto-savings`\n}\n\nexport const LinkModal = ({\n  jwt,\n  url,\n  cleanupActions = {},\n  additionalUrlParams = null\n}) => {\n  if (!jwt) return null\n\n  const body = document.querySelector('body')\n\n  const iframeStyle =\n    'display:block; position:fixed; width:100%; height:100%; z-index:100; border:none; top:0; right:0'\n\n  const createIframe = (url, accountId) => {\n    const iframeId = 'link-iframe'\n    const existingIframe = document.getElementById(iframeId)\n    if (!existingIframe) {\n      const iframe = document.createElement('iframe')\n      let additionalParamsStr = ''\n      if (additionalUrlParams) {\n        additionalParamsStr = Object.keys(additionalUrlParams)\n          .map(\n            (key) =>\n              `&${key}=${additionalUrlParams[key]}\n        `\n          )\n          .join('')\n      }\n      const urlWithParams = `${url}/?jwt=${jwt}&accountId=${accountId}${additionalParamsStr}`\n      iframe.setAttribute('src', urlWithParams)\n      iframe.setAttribute('style', iframeStyle)\n      iframe.setAttribute('id', iframeId)\n      iframe.setAttribute('allow', 'camera')\n      body.appendChild(iframe)\n    }\n  }\n\n  const removeIframe = (event) => {\n    const iframe = document.querySelector('#link-iframe')\n    body.removeChild(iframe)\n    if (event.data.url) {\n      window.location = event.data.url\n    }\n    const endResult = event?.data?.endResult\n    if (endResult && cleanupActions[endResult]) {\n      cleanupActions[endResult]()\n    }\n  }\n\n  window.onmessage = function (event) {\n    if (!Object.values(EVENT_MESSAGES).includes(event.data.type)) {\n      return null\n    }\n    if (event?.data?.type === EVENT_MESSAGES.close) {\n      removeIframe(event)\n    } else {\n      createIframe(event.data.type, event.data.accountId)\n    }\n  }\n\n  return null\n}\n"],"names":["linkUrl","handleOpen","message","accountId","Object","keys","EVENT_MESSAGES","includes","window","parent","postMessage","type","handleClose","url","close","linkConnect","verifyPhone","changePhone","enableTransfer","transferAssets","cryptoSavings","LinkModal","jwt","cleanupActions","additionalUrlParams","body","document","querySelector","iframeStyle","createIframe","iframeId","existingIframe","getElementById","iframe","createElement","additionalParamsStr","map","key","join","urlWithParams","setAttribute","appendChild","removeIframe","event","removeChild","data","location","endResult","onmessage","values"],"mappings":"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"}