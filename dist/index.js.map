{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["const EVENT_MESSAGES = {\n  linkConnect: ``,\n  verifyPhone: `verify-phone`,\n  changePhone: `change-phone`,\n  enableTransfer: `enable-transfer`,\n  transferAssets: `transfer-assets`,\n  cryptoSavings: `crypto-savings`,\n  withdrawAssets: `withdraw-assets`,\n  close: 'blockmate-iframe-close',\n  redirect: 'redirect',\n  deposit: 'deposit-exchange',\n  directDeposit: 'deposit-wallet-connect',\n}\n\nconst TRUSTED_ORIGINS = [\n  'https://link.blockmate.io',\n  'https://link-dev-ovh.blockmate.io',\n  'https://link-cs.blockmate.io',\n  'http://localhost:3000'\n];\n\nconst OAUTH_QUERY_PARAM = 'oauthConnectedAccount';\nconst OAUTH_LOCAL_STORAGE_KEY = 'oauth_connected_account';\nconst DEPOSIT_OAUTH_SUCCESS_STEP = 'oauth_success';\nconst DEPOSIT_ID_PARAM = 'deposit_id';\nconst DEPOSIT_SUCCESS_PARAM = 'success';\nconst DEPOSIT_SUCCESS_PARAM_FOR_MERCHANT = 'payment_success';\nconst DEPOSIT_ERROR_STORAGE_KEY = 'deposit_error';\nconst DEPOSIT_JWT_LOCAL_STORAGE_KEY = 'deposit_jwt';\n\nexport const handleOpen = (message = '', accountId, oauthConnectedAccount, extraUrlParams) => {\n  if (!Object.keys(EVENT_MESSAGES).includes(message)) {\n    message = 'linkConnect';\n  }\n  if (extraUrlParams?.jwt) {\n    localStorage.setItem(DEPOSIT_JWT_LOCAL_STORAGE_KEY, extraUrlParams.jwt);\n  }\n  window.parent.postMessage({ type: message, accountId, oauthConnectedAccount, extraUrlParams }, '*');\n};\n\nexport const handleClose = (endResult) => {\n  window.parent.postMessage({ type: 'close', endResult }, '*');\n};\n\nexport const handleRedirect = (targetUrl) => {\n  window.parent.postMessage({ type: 'redirect', targetUrl }, '*');\n};\n\nexport const createLinkModal = ({\n  jwt,\n  url = 'https://link.blockmate.io/',\n  cleanupActions = {},\n  additionalUrlParams= null,\n  merchantInfo = {\n    description: 'ExampleMerchant',\n    icon: 'https://api.blockmate.io/v1/onchain/static/bitcoin.png',\n  },\n  pollingTimeoutMs = 1000,\n}) => {\n  // For oauth\n  const startOauthSuccessPolling = () => {\n    const oauthPollingInterval = setInterval(() => {\n      const params = new URLSearchParams(window.location.search);\n      const maybeOauthConnectedAccount = params.get(OAUTH_QUERY_PARAM);\n      if (maybeOauthConnectedAccount) {\n        params.delete(OAUTH_QUERY_PARAM);\n        localStorage.setItem(OAUTH_LOCAL_STORAGE_KEY, maybeOauthConnectedAccount);\n        // This will redirect the user to the same page without the query param, but with state in localStorage\n        location.replace(`${window.location.origin}${window.location.pathname}?${params.toString()}`);\n      }\n    }, pollingTimeoutMs);\n  };\n\n  const startDepositSuccessPolling = () => {\n    const depositSuccessPollingInterval = setInterval(() => {\n      const params = new URLSearchParams(window.location.search);\n      const maybeDepositIdParam = params.get(DEPOSIT_ID_PARAM);\n      const maybeSuccessParam = String(params.get(DEPOSIT_SUCCESS_PARAM)).toLowerCase();\n      if (!maybeDepositIdParam || !['true', 'false'].includes(maybeSuccessParam)) {\n        return;\n      }\n      if (maybeSuccessParam === 'true') {\n        localStorage.setItem(DEPOSIT_ERROR_STORAGE_KEY, 'success');\n      } else if (maybeSuccessParam === 'false') {\n        const detailParam = params.get('detail');\n        localStorage.setItem(DEPOSIT_ERROR_STORAGE_KEY, detailParam);\n      }\n      params.delete(DEPOSIT_SUCCESS_PARAM);\n      params.delete('detail');\n      params.set(DEPOSIT_SUCCESS_PARAM_FOR_MERCHANT, maybeSuccessParam);\n      location.replace(`${window.location.origin}${window.location.pathname}?${params.toString()}`);\n    }, pollingTimeoutMs);\n  };\n\n  // For oauth\n  const startLocalStoragePolling = () => {\n    const localStoragePollingInterval = setInterval(() => {\n      const oauthConnectedAccount = localStorage.getItem(OAUTH_LOCAL_STORAGE_KEY);\n      const currentUrl = new URL(window.location.href);\n      const oauthQueryParamDeletedAlready = !currentUrl.searchParams.has(OAUTH_QUERY_PARAM);\n      const depositError = localStorage.getItem(DEPOSIT_ERROR_STORAGE_KEY);\n      const depositErrorParamDeletedAlready = !currentUrl.searchParams.has(DEPOSIT_SUCCESS_PARAM);\n      if (depositErrorParamDeletedAlready && typeof(depositError) === 'string') {\n        createIframe(\n          new URL(EVENT_MESSAGES.deposit, url).href,\n          undefined,\n          undefined,\n          undefined,\n          depositError\n        );\n        localStorage.removeItem(DEPOSIT_ERROR_STORAGE_KEY);\n      }\n      else if (oauthConnectedAccount && oauthQueryParamDeletedAlready) {\n        let path = EVENT_MESSAGES.linkConnect;\n        let step;\n        if (currentUrl.searchParams.has(DEPOSIT_ID_PARAM)) {\n          path = EVENT_MESSAGES.deposit;\n          step = DEPOSIT_OAUTH_SUCCESS_STEP;\n        }\n        createIframe(\n          new URL(path, url).href,\n          undefined,\n          oauthConnectedAccount,\n          step,\n        );\n        localStorage.removeItem(OAUTH_LOCAL_STORAGE_KEY);\n      }\n    }, pollingTimeoutMs);\n  };\n\n  const body = document.querySelector('body');\n  const iframeStyle =\n    'display:block; position:fixed; width:100%; height:100%; z-index:100; border:none; top:0; right:0';\n\n  const createIframe = (url, accountId, oauthConnectedAccount, step, depositError, includeDefaultJwt = true) => {\n    const iframeId = 'link-iframe';\n    const existingIframe = document.getElementById(iframeId);\n    if (!existingIframe) {\n      const parentUrlEncoded = encodeURIComponent(window.location.href);\n      const merchantUrlParams = [['merchantDescription', merchantInfo.description], ['merchantIcon', encodeURIComponent(merchantInfo.icon)]]\n        .filter(([_, value]) => value);\n      console.log(`[REACT-LINK] merchantDescription: ${merchantInfo.description}`);\n      console.log(`[REACT-LINK] merchantIcon: ${encodeURIComponent(merchantInfo.icon)}`);\n      console.log(`[REACT-LINK] merchantIcon unencoded: ${merchantInfo.icon}`);\n      const token = includeDefaultJwt && (jwt || localStorage.getItem(DEPOSIT_JWT_LOCAL_STORAGE_KEY));\n      const params = new URLSearchParams(window.location.search);\n      const providerNameParam = params.get('providerName');\n      const urlParamsArray = [\n        ['jwt', token],\n        ['accountId', accountId],\n        ['step', step],\n        ['depositError', depositError],\n        ['providerName', providerNameParam],\n        ...merchantUrlParams,\n        ...Object.entries(additionalUrlParams ?? {}),\n        ['parentUrlEncoded', parentUrlEncoded],\n      ].filter(([key, value]) => value);\n      let urlParams = urlParamsArray.map(([key, value]) => `${key}=${value}`).join('&');\n      if (url.includes('?')) {\n        urlParams = `&${urlParams}`;\n      } else if (urlParams.length > 0) {\n        urlParams = `?${urlParams}`;\n      }\n      let urlWithParams = `${url}${urlParams}`;\n      if (oauthConnectedAccount) {\n        urlWithParams += `&${OAUTH_QUERY_PARAM}=${oauthConnectedAccount}`;\n      }\n\n      const iframe = document.createElement('iframe');\n      iframe.setAttribute('src', urlWithParams);\n      iframe.setAttribute('style', iframeStyle);\n      iframe.setAttribute('id', iframeId);\n      iframe.setAttribute('allow', 'camera');  // For QR-code scanning\n      body.appendChild(iframe);\n    }\n  };\n\n  const removeIframe = (event) => {\n    const iframe = document.querySelector('#link-iframe');\n    if (iframe) {\n      body.removeChild(iframe);\n    }\n    if (event.data.url) {\n      window.location = event.data.url;\n    }\n\n    const endResult = event?.data?.endResult\n    if (endResult && cleanupActions[endResult]) {\n      cleanupActions[endResult]();\n    }\n  };\n\n  startDepositSuccessPolling();\n  startOauthSuccessPolling();\n  startLocalStoragePolling();\n\n  window.onmessage = function (event) {\n    if (!Object.hasOwn(EVENT_MESSAGES, event.data.type)) {\n      return null;\n    }\n\n    // These actions can only be called from within the iframe, check origin as they can perform redirects of the parent\n    if (['close', 'redirect'].includes(event?.data?.type)) {\n      if (!TRUSTED_ORIGINS.includes(event.origin)) {\n        return null;\n      }\n    }\n\n    if (event?.data?.type === 'close') {\n      if (jwt) {\n        localStorage.setItem(DEPOSIT_JWT_LOCAL_STORAGE_KEY, jwt);\n      }\n      removeIframe(event);\n    } else if (event?.data?.type === 'redirect') {\n      if (jwt) {\n        localStorage.setItem(DEPOSIT_JWT_LOCAL_STORAGE_KEY, jwt);\n      }\n      window.location.replace(event.data.targetUrl);\n    } else {\n      let urlParams = Object.entries((event.data.extraUrlParams ?? {})).map(([key, value]) => `${key}=${value}`).join('&');\n      if (urlParams.length > 0) {\n        urlParams = `?${urlParams}`;\n      }\n      const includeDefaultJwt = !event.data.extraUrlParams?.jwt;\n      createIframe(\n        new URL(`${EVENT_MESSAGES[event.data.type]}${urlParams}`, url).href,\n        event.data?.accountId,\n        event.data?.oauthConnectedAccount,\n        undefined,\n        undefined,\n        includeDefaultJwt,\n      );\n    }\n  };\n};\n\n// React component\nexport const LinkModal = ({\n  jwt,\n  url = 'https://link.blockmate.io/',\n  cleanupActions = {},\n  additionalUrlParams= null,\n  merchantInfo = {\n    description: 'ExampleMerchant',\n    icon: 'https://api.blockmate.io/v1/onchain/static/bitcoin.png',\n  },\n}) => {\n  createLinkModal({jwt, url, cleanupActions, additionalUrlParams, merchantInfo});\n  return null;\n};\n\nif (typeof window !== 'undefined') {\n  window.BlockmateLink = {\n    handleOpen,\n    handleClose,\n    handleRedirect,\n    createLinkModal,\n  };\n}\n"],"names":["EVENT_MESSAGES","linkConnect","verifyPhone","changePhone","enableTransfer","transferAssets","cryptoSavings","withdrawAssets","close","redirect","deposit","directDeposit","TRUSTED_ORIGINS","OAUTH_QUERY_PARAM","OAUTH_LOCAL_STORAGE_KEY","DEPOSIT_OAUTH_SUCCESS_STEP","DEPOSIT_ID_PARAM","DEPOSIT_SUCCESS_PARAM","DEPOSIT_SUCCESS_PARAM_FOR_MERCHANT","DEPOSIT_ERROR_STORAGE_KEY","DEPOSIT_JWT_LOCAL_STORAGE_KEY","handleOpen","message","accountId","oauthConnectedAccount","extraUrlParams","Object","keys","includes","jwt","localStorage","setItem","window","parent","postMessage","type","handleClose","endResult","handleRedirect","targetUrl","createLinkModal","url","cleanupActions","additionalUrlParams","merchantInfo","description","icon","pollingTimeoutMs","startOauthSuccessPolling","oauthPollingInterval","setInterval","params","URLSearchParams","location","search","maybeOauthConnectedAccount","get","replace","origin","pathname","toString","startDepositSuccessPolling","depositSuccessPollingInterval","maybeDepositIdParam","maybeSuccessParam","String","toLowerCase","detailParam","set","startLocalStoragePolling","localStoragePollingInterval","getItem","currentUrl","URL","href","oauthQueryParamDeletedAlready","searchParams","has","depositError","depositErrorParamDeletedAlready","createIframe","undefined","removeItem","path","step","body","document","querySelector","iframeStyle","includeDefaultJwt","iframeId","existingIframe","getElementById","parentUrlEncoded","encodeURIComponent","merchantUrlParams","filter","value","console","log","token","providerNameParam","urlParamsArray","entries","urlParams","map","key","join","length","urlWithParams","iframe","createElement","setAttribute","appendChild","removeIframe","event","removeChild","data","onmessage","hasOwn","LinkModal","BlockmateLink"],"mappings":"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"}