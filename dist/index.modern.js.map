{"version":3,"file":"index.modern.js","sources":["../src/index.js"],"sourcesContent":["/* eslint-disable */\n\nwindow.Buffer = window.Buffer || require('buffer').Buffer\n\nconst EVENT_MESSAGES = {\n  linkConnect: ``,\n  verifyPhone: `verify-phone`,\n  changePhone: `change-phone`,\n  enableTransfer: `enable-transfer`,\n  transferAssets: `transfer-assets`,\n  cryptoSavings: `crypto-savings`,\n  withdrawAssets: `withdraw-assets`,\n  close: 'blockmate-iframe-close',\n  redirect: 'redirect',\n  deposit: 'deposit-exchange',\n  directDeposit: 'deposit-wallet-connect',\n  withdrawal: 'withdrawal-exchange',\n}\n\nconst TRUSTED_ORIGINS = [\n  'https://link.blockmate.io',\n  'https://link-dev-ovh.blockmate.io',\n  'https://link-cs.blockmate.io',\n  'http://localhost:3000'\n]\n\nconst OAUTH_QUERY_PARAM = 'oauthConnectedAccount'\nconst OAUTH_LOCAL_STORAGE_KEY = 'oauth_connected_account'\nconst DEPOSIT_OAUTH_SUCCESS_STEP = 'oauth_success'\nconst DEPOSIT_ID_PARAM = 'deposit_id'\nconst DEPOSIT_SUCCESS_PARAM = 'success'\nconst DEPOSIT_SUCCESS_PARAM_FOR_MERCHANT = 'payment_success'\nconst DEPOSIT_ERROR_STORAGE_KEY = 'deposit_error'\nconst DEPOSIT_JWT_LOCAL_STORAGE_KEY = 'deposit_jwt'\nconst MODAL_TYPE_LOCAL_STORAGE_KEY = 'modal_type'\n\nexport const handleOpen = (\n  message = '',\n  accountId,\n  oauthConnectedAccount,\n  extraUrlParams\n) => {\n  if (!Object.keys(EVENT_MESSAGES).includes(message)) {\n    message = 'linkConnect'\n  }\n  if (extraUrlParams?.jwt) {\n    localStorage.setItem(DEPOSIT_JWT_LOCAL_STORAGE_KEY, extraUrlParams.jwt)\n  }\n  localStorage.setItem(MODAL_TYPE_LOCAL_STORAGE_KEY, message)\n  window.parent.postMessage(\n    { type: message, accountId, oauthConnectedAccount, extraUrlParams },\n    '*'\n  )\n}\n\nexport const handleClose = (endResult) => {\n  window.parent.postMessage({ type: 'close', endResult }, '*')\n}\n\nexport const handleRedirect = (targetUrl, inNewTab = false) => {\n  window.parent.postMessage({ type: 'redirect', targetUrl, inNewTab }, '*')\n}\n\nexport const handleInit = () => {\n  window.parent.postMessage({ type: 'init' }, '*')\n}\n\nexport const createLinkModal = ({\n  jwt,\n  url = 'https://link.blockmate.io/',\n  cleanupActions = {},\n  additionalUrlParams = null,\n  pollingTimeoutMs = 1000\n}) => {\n  // For oauth\n  const startOauthSuccessPolling = () => {\n    const oauthPollingInterval = setInterval(() => {\n      const params = new URLSearchParams(window.location.search)\n      const maybeOauthConnectedAccount = params.get(OAUTH_QUERY_PARAM)\n      if (maybeOauthConnectedAccount) {\n        params.delete(OAUTH_QUERY_PARAM)\n        localStorage.setItem(\n          OAUTH_LOCAL_STORAGE_KEY,\n          maybeOauthConnectedAccount\n        )\n        // // This will redirect the user to the same page without the query param, but with state in localStorage\n        // location.replace(\n        //   `${window.location.origin}${\n        //     window.location.pathname\n        //   }?${params.toString()}`\n        // )\n        window.close();\n      }\n    }, pollingTimeoutMs)\n  }\n\n  const startDepositSuccessPolling = () => {\n    const depositSuccessPollingInterval = setInterval(() => {\n      const params = new URLSearchParams(window.location.search)\n      const maybeDepositIdParam = params.get(DEPOSIT_ID_PARAM)\n      const maybeSuccessParam = String(\n        params.get(DEPOSIT_SUCCESS_PARAM)\n      ).toLowerCase()\n      if (\n        !maybeDepositIdParam ||\n        !['true', 'false'].includes(maybeSuccessParam)\n      ) {\n        return\n      }\n      if (maybeSuccessParam === 'true') {\n        localStorage.setItem(DEPOSIT_ERROR_STORAGE_KEY, 'success')\n      } else if (maybeSuccessParam === 'false') {\n        const detailParam = params.get('detail')\n        localStorage.setItem(DEPOSIT_ERROR_STORAGE_KEY, detailParam)\n      }\n      params.delete(DEPOSIT_SUCCESS_PARAM)\n      params.delete('detail')\n      params.set(DEPOSIT_SUCCESS_PARAM_FOR_MERCHANT, maybeSuccessParam)\n      location.replace(\n        `${window.location.origin}${\n          window.location.pathname\n        }?${params.toString()}`\n      )\n    }, pollingTimeoutMs)\n  }\n\n  // For oauth\n  const startLocalStoragePolling = () => {\n    const localStoragePollingInterval = setInterval(() => {\n      const oauthConnectedAccount = localStorage.getItem(\n        OAUTH_LOCAL_STORAGE_KEY\n      )\n      const currentUrl = new URL(window.location.href)\n      const oauthQueryParamDeletedAlready =\n        !currentUrl.searchParams.has(OAUTH_QUERY_PARAM)\n      const depositError = localStorage.getItem(DEPOSIT_ERROR_STORAGE_KEY)\n      const depositErrorParamDeletedAlready = !currentUrl.searchParams.has(\n        DEPOSIT_SUCCESS_PARAM\n      )\n      const modalType = localStorage.getItem(MODAL_TYPE_LOCAL_STORAGE_KEY)\n      if (depositErrorParamDeletedAlready && typeof depositError === 'string') {\n        createIframe(\n          new URL(EVENT_MESSAGES?.[modalType] ?? '', url).href,\n          undefined,\n          undefined,\n          undefined,\n          depositError\n        )\n        localStorage.removeItem(DEPOSIT_ERROR_STORAGE_KEY)\n      } else if (oauthConnectedAccount && oauthQueryParamDeletedAlready) {\n        let path = EVENT_MESSAGES.linkConnect\n        let step\n        if (localStorage.getItem(DEPOSIT_JWT_LOCAL_STORAGE_KEY)) {\n          if (modalType === 'deposit') {\n            path = EVENT_MESSAGES.deposit\n            step = DEPOSIT_OAUTH_SUCCESS_STEP\n          } else if (modalType === 'withdrawal') {\n            path = EVENT_MESSAGES.withdrawal\n            step = DEPOSIT_OAUTH_SUCCESS_STEP\n          }\n        }\n        createIframe(\n          new URL(path, url).href,\n          undefined,\n          oauthConnectedAccount,\n          step,\n          undefined,\n        )\n        // Delete from localStorage, but from the original tab, not the new tab used from oauth\n        const params = new URLSearchParams(window.location.search)\n        const maybeOauthConnectedAccount = params.get(OAUTH_QUERY_PARAM)\n        if (!maybeOauthConnectedAccount) {\n          localStorage.removeItem(OAUTH_LOCAL_STORAGE_KEY)\n        }\n      }\n    }, pollingTimeoutMs)\n  }\n\n  const body = document.querySelector('body')\n\n  const spinnerId = 'iframe-loading-spinner'\n\n  const createSpinner = () => {\n    const spinnerWrapper = document.createElement('div')\n    spinnerWrapper.setAttribute('id', spinnerId)\n    spinnerWrapper.setAttribute(\n      'style',\n      `\n        position: fixed;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        z-index: 101;\n      `\n    )\n\n    const spinner = document.createElement('div')\n    spinner.setAttribute(\n      'style',\n      `\n        width: 48px;\n        height: 48px;\n        border: 6px solid rgba(255, 255, 255, 0.3);\n        border-top-color: white;\n        border-radius: 50%;\n        animation: spin 1s linear infinite;\n      `\n    )\n\n    spinnerWrapper.appendChild(spinner)\n    body.appendChild(spinnerWrapper)\n\n    const style = document.createElement('style')\n    style.innerHTML = `\n      @keyframes spin {\n        0% { transform: rotate(0deg); }\n        100% { transform: rotate(360deg); }\n      }\n    `\n    document.head.appendChild(style)\n  }\n\n  const iframeStyle =\n    'display:block; position:fixed; width:100%; height:100%; z-index:100; border:none; top:0; right:0; background-color: rgba(0, 0, 0, 0.55);'\n\n  const createIframe = (\n    url,\n    accountId,\n    oauthConnectedAccount,\n    step,\n    depositError,\n    includeDefaultJwt = true\n  ) => {\n    const iframeId = 'link-iframe'\n    const existingIframe = document.getElementById(iframeId)\n    if (!existingIframe) {\n      createSpinner();\n      const parentUrlEncoded = Buffer.from(window.location.href).toString(\n        'base64'\n      )\n      const token =\n        includeDefaultJwt &&\n        (jwt || localStorage.getItem(DEPOSIT_JWT_LOCAL_STORAGE_KEY))\n      const params = new URLSearchParams(window.location.search)\n      const providerNameParam = params.get('providerName')\n      const urlParamsArray = [\n        ['jwt', token],\n        ['accountId', accountId],\n        ['step', step],\n        ['depositError', depositError],\n        ['providerName', providerNameParam],\n        ['parentUrlEncoded', parentUrlEncoded],\n        ...Object.entries(additionalUrlParams ?? {})\n      ].filter(([_, value]) => value)\n      let urlParams = urlParamsArray\n        .map(([key, value]) => `${key}=${value}`)\n        .join('&')\n      if (url.includes('?')) {\n        urlParams = `&${urlParams}`\n      } else if (urlParams.length > 0) {\n        urlParams = `?${urlParams}`\n      }\n      let urlWithParams = `${url}${urlParams}`\n      if (oauthConnectedAccount) {\n        urlWithParams += `&${OAUTH_QUERY_PARAM}=${oauthConnectedAccount}`\n      }\n\n      const iframe = document.createElement('iframe')\n      iframe.setAttribute('src', urlWithParams)\n      iframe.setAttribute('style', iframeStyle)\n      iframe.setAttribute('id', iframeId)\n      iframe.setAttribute('allow', 'camera') // For QR-code scanning\n\n      iframe.addEventListener('load', () => {\n        const spinner = document.getElementById(spinnerId)\n        if (spinner) spinner.remove()\n      })\n\n      body.appendChild(iframe)\n    }\n  }\n\n  const removeIframe = (event) => {\n    const iframe = document.querySelector('#link-iframe')\n    if (iframe) {\n      body.removeChild(iframe)\n    }\n    if (event.data.url) {\n      window.location = event.data.url\n    }\n\n    const endResult = event?.data?.endResult\n    if (endResult && cleanupActions[endResult]) {\n      cleanupActions[endResult]()\n    }\n  }\n\n  startDepositSuccessPolling()\n  startOauthSuccessPolling()\n  startLocalStoragePolling()\n\n  window.onmessage = function (event) {\n    if (!Object.hasOwn(EVENT_MESSAGES, event.data.type)) {\n      return null\n    }\n\n    // These actions can only be called from within the iframe, check origin as they can perform redirects of the parent\n    if (['close', 'redirect'].includes(event?.data?.type)) {\n      if (!TRUSTED_ORIGINS.includes(event.origin)) {\n        return null\n      }\n    }\n\n    if (event?.data?.type === 'init') {\n      localStorage.removeItem(OAUTH_LOCAL_STORAGE_KEY);\n    } else if (event?.data?.type === 'close') {\n      if (jwt) {\n        localStorage.setItem(DEPOSIT_JWT_LOCAL_STORAGE_KEY, jwt)\n      }\n      removeIframe(event)\n    } else if (event?.data?.type === 'redirect') {\n      if (jwt) {\n        localStorage.setItem(DEPOSIT_JWT_LOCAL_STORAGE_KEY, jwt)\n      }\n      const opened = window.open(event.data.targetUrl, event.data.inNewTab ? '_blank' : '_self');\n      if (!opened) {\n        console.error('Redirect BLOCKED');\n      }\n    } else {\n      let urlParams = Object.entries(event?.data?.extraUrlParams ?? {})\n        .map(([key, value]) => `${key}=${value}`)\n        .join('&')\n      if (urlParams.length > 0) {\n        urlParams = `?${urlParams}`\n      }\n      const includeDefaultJwt = !event.data.extraUrlParams?.jwt\n      createIframe(\n        new URL(`${EVENT_MESSAGES[event.data.type]}${urlParams}`, url).href,\n        event.data?.accountId,\n        event.data?.oauthConnectedAccount,\n        undefined,\n        undefined,\n        includeDefaultJwt\n      )\n    }\n  }\n}\n\n// React component\nexport const LinkModal = ({\n  jwt,\n  url = 'https://link.blockmate.io/',\n  cleanupActions = {},\n  additionalUrlParams = null\n}) => {\n  createLinkModal({ jwt, url, cleanupActions, additionalUrlParams })\n  return null\n}\n\nif (typeof window !== 'undefined') {\n  window.BlockmateLink = {\n    handleOpen,\n    handleClose,\n    handleRedirect,\n    createLinkModal,\n    handleInit\n  }\n}\n"],"names":["window","Buffer","require","EVENT_MESSAGES","linkConnect","verifyPhone","changePhone","enableTransfer","transferAssets","cryptoSavings","withdrawAssets","close","redirect","deposit","directDeposit","withdrawal","TRUSTED_ORIGINS","OAUTH_QUERY_PARAM","OAUTH_LOCAL_STORAGE_KEY","DEPOSIT_OAUTH_SUCCESS_STEP","DEPOSIT_ID_PARAM","DEPOSIT_SUCCESS_PARAM","DEPOSIT_SUCCESS_PARAM_FOR_MERCHANT","DEPOSIT_ERROR_STORAGE_KEY","DEPOSIT_JWT_LOCAL_STORAGE_KEY","MODAL_TYPE_LOCAL_STORAGE_KEY","handleOpen","message","accountId","oauthConnectedAccount","extraUrlParams","Object","keys","includes","jwt","localStorage","setItem","parent","postMessage","type","handleClose","endResult","handleRedirect","targetUrl","inNewTab","handleInit","createLinkModal","url","cleanupActions","additionalUrlParams","pollingTimeoutMs","startOauthSuccessPolling","oauthPollingInterval","setInterval","params","URLSearchParams","location","search","maybeOauthConnectedAccount","get","startDepositSuccessPolling","depositSuccessPollingInterval","maybeDepositIdParam","maybeSuccessParam","String","toLowerCase","detailParam","set","replace","origin","pathname","toString","startLocalStoragePolling","localStoragePollingInterval","getItem","currentUrl","URL","href","oauthQueryParamDeletedAlready","searchParams","has","depositError","depositErrorParamDeletedAlready","modalType","createIframe","undefined","removeItem","path","step","body","document","querySelector","spinnerId","createSpinner","spinnerWrapper","createElement","setAttribute","spinner","appendChild","style","innerHTML","head","iframeStyle","includeDefaultJwt","iframeId","existingIframe","getElementById","parentUrlEncoded","from","token","providerNameParam","urlParamsArray","entries","filter","value","urlParams","map","key","join","length","urlWithParams","iframe","addEventListener","remove","removeIframe","event","removeChild","data","onmessage","hasOwn","opened","open","console","error","LinkModal","BlockmateLink"],"mappings":"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"}